{% extends 'facturacion/base.html' %}

{% block title %}Crear Cotizaci贸n{% endblock %}

{% block content %}
<h2>Crear Cotizaci贸n</h2>
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}  <!-- Formulario principal de la cotizaci贸n -->
    <h3>Productos</h3>
    {{ formset.management_form }}  <!-- Gesti贸n del formset -->
    <table class="table">
        <thead>
            <tr>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Precio Unitario</th>
                <th>Descuento</th>
            </tr>
        </thead>
        <tbody>
            {% for form in formset %}
            <tr>
                <td>{{ form.producto }}</td>
                <td>{{ form.cantidad }}</td>
                <td>{{ form.precio_unitario_sin_iva }}</td>
                <td>{{ form.descuento }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <button type="submit" class="btn btn-primary">Guardar</button>
    <a href="{% url 'lista_cotizaciones' %}" class="btn btn-secondary">Cancelar</a>
</form>
{% endblock %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const addButton = document.createElement('button');
        addButton.textContent = 'Agregar Producto';
        addButton.className = 'btn btn-secondary mt-3';
        addButton.type = 'button';
    
        const formsetContainer = document.querySelector('tbody');
        const totalForms = document.getElementById('id_form-TOTAL_FORMS');
    
        addButton.addEventListener('click', function() {
            const formCount = parseInt(totalForms.value);
            const newForm = formsetContainer.querySelector('tr').cloneNode(true);
            newForm.innerHTML = newForm.innerHTML.replace(/form-\d+/g, `form-${formCount}`);
            formsetContainer.appendChild(newForm);
            totalForms.value = formCount + 1;
        });
    
        document.querySelector('form').appendChild(addButton);
    });
    </script>